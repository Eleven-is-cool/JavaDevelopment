# OSI七层

<img src="https://github.com/Eleven-is-cool/img-folder/blob/master/OSI.gif?raw=true" alt="OSI"  />

一个设备工作在哪一层，关键看它工作时利用哪一层的数据头部信息。

OSI下3层的主要任务是**数据通信**，上3层的任务是**数据处理**。

网桥工作时，是以**MAC头部**来决定转发端口的，因此显然它是**数据链路层**的设备。

物理层：网卡，**网线**，集线器，中继器，调制解调器；

> 集线器是物理层设备，采用**广播**的形式来传输信息。

数据链路层：网桥，**交换机**；

网络层：**路由器**；

**网关工作**在第四层传输层及其以上。

<span style='color:#2e86de'>**交换机**</span>

交换机就是用来进行报文交换的机器。多为链路层设备(二层交换机)，能够进行**地址学习**，**采用存储转发的形式来交换报文**。

通过交换机的过滤和转发，可以有效的隔离**广播风暴，减少误包和错包的出现，避免共享冲突**。 

交换机是一种基**于MAC地址识别**，能**完成封装转发数据包功能的网络设备**。交换机可以“学习"MAC地址，并将其存放在内部地址表中，通过在数据帧的始发者和目标接收者之间建立临时的交换路径，使**数据帧直接由源地址到达目的地址**。

<span style='color:#2e86de'>**路由器**</span>

路由器的一个作用是**连通不同的网络**，另一个作用是**选择信息传送的线路**。选择通畅快捷的近路，能大大提高通信速度，减轻网络系统通信负荷，节约网络系统资源，提高网络系统畅通率。 

**与工作在数据链路层，从物理上划分网段的交换机不同，路由器使用专门的软件协议从逻辑上对整个网络进行划分。**

> 路由器与交换机的主要区别体现在以下几个方面

1. **工作层次不同** 
   

最初的的**交换机是工作在数据链路层**，而**路由器**一开始就设计工作在**网络层**。由于交换机工作在数据链路层，所以它的工作原理比较简单，而路由器工作在网络层，可以得到更多的协议信息，路由器可以做出更加智能的转发决策。 

2. **数据转发所依据的对象不同** 

   **交换机是利用物理地址或者说MAC地址来确定转发数据的目的地址**。而**路由器则是利用IP地址来确定数据转发的地址**。IP地址是在软件中实现的，描述的是设备所在的网络。MAC地址通常是硬件自带的，由网卡生产商来分配的，而且已经**固化到了网卡**中去，一般来说是不可更改的。而**IP地址则通常由网络管理员或系统自动分配**。 

3. **传统的交换机只能分割冲突域，不能分割广播域；而路由器可以分割广播域** 

   由交换机连接的网段仍属于同一个广播域，广播数据包会在交换机连接的所有网段上传播，在某些情况下会导致通信拥挤和安全漏洞。连接到路由器上的网段会被分配成不同的广播域，广播数据不会穿过路由器。虽然第三层以上交换机具有VLAN功能，也可以分割广播域，但是各子广播域之间是不能通信交流的，它们之间的交流仍然需要路由器。 

4. **路由器提供了防火墙的服务** 

   路由器仅仅转发特定地址的数据包，不传送不支持路由协议的数据包传送和未知目标网络数据包的传送，从而可以**防止广播风暴**。

<span style='color:#2e86de'>**集线器**</span>

将一些机器连接起来组成一个局域网。

<span style='color:#2e86de'>**全流程**</span>

**当你输入一个网址并按下回车键的时候，首先，应用层协议对该请求包做了格式定义；紧接着传输层协议加上了双方的端口号，确认了双方通信的应用程序；然后网络协议加上了双方的IP地址，确认了双方的网络位置；最后链路层协议加上了双方的MAC地址，确认了双方的物理位置，同时将数据进行分组，形成数据帧，采用广播方式，通过传输介质发送给对方主机。而对于不同网段，该数据包首先会转发给网关路由器，经过多次转发后，最终被发送到目标主机。目标机接收到数据包后，采用对应的协议，对帧数据进行组装，然后再通过一层一层的协议进行解析，最终被应用层的协议解析并交给服务器处理。**

## 物理层

数据被称为**比特流**（Bits）。

物理层的主要功能是：**利用传输介质为数据链路层提供物理连接，实现比特流的透明传输。**

物理层的作用是实现相邻计算机节点之间比特流的透明传送，尽可能屏蔽掉具体传输介质和物理设备的差异。使其上面的数据链路层不必考虑网络的具体传输介质是什么。“透明传送比特流”表示经实际电路传送后的比特流没有发生变化，对传送的比特流来说，这个电路好像是看不见的。

## 数据链路层

数据被称为**帧**（Frames）。

**加以太网首部。**

在计算机网络中由于各种干扰的存在，物理链路是**不可靠**的。该层的主要功能是：**通过各种控制协议，将有差错的物理信道变为无差错的、能可靠传输数据帧的数据链路。**

数据链路层的具体工作是**接收来自物理层的位流形式的数据，并封装成帧，传送到上一层；同样，也将来自上层的数据帧，拆装为位流形式的数据转发到物理层；并且，还负责处理接收端发回的确认帧的信息，以便提供可靠的数据传输。**

网络通信就是把有特定意义的数据通过物理介质传送给对方，单纯的发送 0 和 1 是没有意义的，要传输有意义的数据，就需要以字节为单位对 0 和 1 进行分组，并且要标识好每一组电信号的信息特征，然后按照分组的顺序依次发送。以太网规定一组电信号就是一个数据包，一个数据包被称为**一帧，** 制定这个规则的协议就是**以太网协议**。

> ### 以太网协议
>
> :rotating_light: ​以太网协议是一个规定数据链路层及物理层的协议。
>
> :link: [数据链路层之以太网协议](https://blog.csdn.net/liuchenxia8/article/details/80598176)

一个完整的以太网数据包如下图所示：

<img src="https://github.com/Eleven-is-cool/img-folder/blob/master/%E4%BB%A5%E5%A4%AA%E7%BD%91%E6%95%B0%E6%8D%AE%E5%8C%85.png?raw=true" alt="img" style="zoom: 50%;" />

整个数据帧由**首部**、**数据**和**尾部**三部分组成，首部固定为14个字节，包含了目标MAC地址、源MAC地址和类型；数据最短为46个字节，最长为1500个字节，如果需要传输的数据很长，就必须分割成多个帧进行发送；尾部固定为4个字节，表示数据帧校验序列，用于确定数据包在传输过程中是否损坏。因此，以太网协议通过对电信号进行分组并形成数据帧，然后通过物理介质把数据帧发送给接收方。那么以太网如何来识接收方的身份呢？

以太网规协议定，接入网络的设备都必须安装网络适配器，即**网卡，** 数据包必须是从一块网卡传送到另一块网卡。而**网卡地址**就是数据包的发送地址和接收地址，也就是帧首部所包含的**MAC地址**，MAC地址是每块网卡的身份标识，就如同我们身份证上的身份证号码，具有全球唯一性。MAC地址采用十六进制标识，共6个字节， 前三个字节是厂商编号，后三个字节是网卡流水号，例如 **4C-0F-6E-12-D2-19**

有了MAC地址以后，以太网采用**广播**形式，把数据包发给该**子网内**所有主机，子网内每台主机在接收到这个包以后，都会读取首部里的**目标MAC地址**，**然后和自己的MAC地址进行对比，如果相同就做下一步处理，如果不同，就丢弃这个包。**

所以链路层的主要工作就是**对电信号进行分组并形成具有特定意义的数据帧，然后以广播的形式通过物理介质发送给接收方。**

## 网络层

**IP协议**、**ARP协议**、**路由协议。**

> [https://www.cnblogs.com/onepixel/p/7092302.html](https://www.cnblogs.com/onepixel/p/7092302.html)

数据被称做**包**（Packages）。

**加IP首部。**

通过**路由选择算法**，为**报文或分组通过通信子网选择最适当的路径**。该层**控制数据链路层与传输层之间的信息转发，建立、维持和终止网络的连接。**

数据链路层的数据在这一层被转换为数据包，然后通过路径选择、分段组合、顺序、进/出路由等控制，**将信息从一个网络设备传送到另一个网络设备。**

**数据链路层是解决同一网络内节点之间的通信，而网络层主要解决不同子网间的通信。**

## 传输层

数据被称作**段**（Segments）。

加TCP/UDP首部。

该层的主要任务是：**向用户提供可靠的端到端的差错和流量控制，保证报文的正确传输。**

输层的主要功能如下：

1. **传输连接管理**：提供建立、维护和拆除传输连接的功能。传输层在网络层的基础上为高层提供“面向连接”和“面向无接连”的两种服务。

2. **处理传输差错**：提供可靠的“面向连接”和不太可靠的“面向无连接”的数据传输服务、差错控制和流量控制。在提供“面向连接”服务时，通过这一层传输的数据将由目标设备确认，如果在指定的时间内未收到确认信息，数据将被重发。

3. **监控服务质量**。

## 会话层

向两个实体的表示层提供**建立和使用连接**的方法。将不同实体之间的表示层的连接称为会话。

用户可以按照**半双工**、**单工**和**全双工**的方式建立会话。

## 表示层

处理用户信息的表示问题，如**编码、数据格式转换和加密解密**。

## 应用层

直接向用户提供服务，完成用户希望在网络上完成的各种工作。